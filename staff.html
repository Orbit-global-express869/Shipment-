<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Orbit Global Express - Staff Portal</title>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    :root {
      --primary: #004aad;
      --accent: #ffd700;
      --success: #28a745;
      --bg-light: #f4f7f9;
      --text-dark: #2c3e50;
      --border: #e0e6ed;
      --warning: #fff3cd;
      --warning-text: #856404;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg-light); color: var(--text-dark); line-height: 1.6; }

    nav { background: var(--primary); padding: 1rem; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    nav ul { list-style: none; display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; align-items: center; }
    nav a { color: white; text-decoration: none; font-weight: 600; font-size: 1rem; }

    .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
    section { margin-bottom: 50px; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
    h2 { color: var(--primary); text-align: center; margin-bottom: 30px; font-size: 2.2rem; }
    
    input, textarea, select { padding: 14px; border: 2px solid var(--border); border-radius: 10px; width: 100%; margin-bottom: 10px; font-family: inherit; font-size: 1rem; }
    
    .admin-card { background: #f9f9f9; padding: 20px; border-radius: 12px; margin-bottom: 12px; border-left: 5px solid var(--primary); display: flex; align-items: center; justify-content: space-between;}
    .edit-btn { background: #004aad; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85rem; }
    .delete-btn { background: transparent; color: red; border: 1px solid red; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85rem; }
    
    .override-box { background: #eef2f7; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px dashed var(--primary); }
    .help-text { font-size: 0.8rem; color: #666; margin-bottom: 10px; background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #ddd; }
  </style>
</head>
<body>

  <nav>
    <ul><li><a href="#">Orbit Staff Portal</a></li></ul>
  </nav>

  <div class="container">
    <section id="admin">
      <h2>Staff Manifest Portal</h2>
      <form id="add-form">
        <input type="text" id="add-number" placeholder="Tracking ID (e.g. OGE-7744)" required>
        <div style="display:flex; gap:10px;">
            <input type="text" id="add-origin" placeholder="Origin" required>
            <input type="text" id="add-destination" placeholder="Destination" required>
        </div>
        <input type="text" id="add-address" placeholder="Full Recipient Address" required>
        <div style="display:flex; gap:10px;">
            <input type="email" id="add-email" placeholder="Customer Email" required>
            <input type="tel" id="add-phone" placeholder="Customer Phone" required>
        </div>
        
        <div style="background:#fff3cd; padding:15px; border-radius:10px; margin-bottom:15px; border: 1px solid #ffeeba;">
            <label style="font-size:0.85rem; font-weight:bold;">Security Hold Status</label>
            <select id="add-hold">
                <option value="false">Active (Moving Normally)</option>
                <option value="true">On Hold (Block Transit)</option>
            </select>
            <input type="text" id="add-hold-reason" placeholder="Reason for Hold (Visible to customer)">
        </div>

        <div class="override-box">
            <label style="font-size:0.85rem; font-weight:bold; color: var(--primary);">Manual Stage Override</label>
            <select id="add-override-active">
                <option value="false">Off (Use Automatic Timer)</option>
                <option value="true">On (Force to specific step)</option>
            </select>
            <input type="number" id="add-override-step" placeholder="Force to Step # (e.g. 1, 2, 3...)" min="1">
            <small style="display:block; margin-top:5px; color:#666;">If On, the system ignores time and pushes the package to this step number.</small>
        </div>

        <label style="font-weight: bold; color: var(--primary);">Route Manifest</label>
        <div class="help-text">
            <strong>Time Format:</strong> Use <code>Hours:Minutes</code><br>
            Example: <code>London - 1:30 - ðŸ“¦</code> (for 1 hour 30 mins)
        </div>
        <textarea id="add-route" placeholder="Location - HH:MM - Icon" rows="6" required></textarea>
        
        <button type="submit" id="create-btn" style="width:100%; padding:16px; background:var(--primary); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Save Manifest to Cloud</button>
      </form>
      
      <div id="shipment-list" style="margin-top:30px;">
          <h3>Active Database</h3>
      </div>
    </section>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAreX9tA9P0t8qHdbD9P0t8qHdbD9",
      authDomain: "orbit-global-b4699.firebaseapp.com",
      databaseURL: "https://orbit-global-b4699-default-rtdb.firebaseio.com",
      projectId: "orbit-global-b4699",
      storageBucket: "orbit-global-b4699.appspot.com",
      messagingSenderId: "456431441728",
      appId: "1:456431441728:web:e1742f5341441728"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function parseTimeToHours(timeStr) {
        if (!timeStr.toString().includes(':')) return parseFloat(timeStr) || 0;
        const parts = timeStr.split(':');
        const h = parseFloat(parts[0]) || 0;
        const m = parseFloat(parts[1]) || 0;
        return h + (m / 60);
    }

    function renderAdminList() {
      db.ref('shipments').on('value', (snap) => {
        const data = snap.val() || {};
        const list = document.getElementById('shipment-list');
        list.innerHTML = '<h3>Active Database</h3>';
        Object.keys(data).forEach(num => {
          const div = document.createElement('div');
          div.className = 'admin-card';
          div.innerHTML = `<strong>${num}</strong> <div><button class="edit-btn" onclick="editShipment('${num}')">Edit</button><button class="delete-btn" onclick="deleteShipment('${num}')">Delete</button></div>`;
          list.appendChild(div);
        });
      });
    }

    window.editShipment = function(num) {
        db.ref('shipments/' + num).once('value', (snap) => {
            const s = snap.val();
            document.getElementById('add-number').value = num;
            document.getElementById('add-origin').value = s.origin;
            document.getElementById('add-destination').value = s.destination;
            document.getElementById('add-address').value = s.address;
            document.getElementById('add-email').value = s.email;
            document.getElementById('add-phone').value = s.phone;
            document.getElementById('add-hold').value = s.onHold ? "true" : "false";
            document.getElementById('add-hold-reason').value = s.holdReason || "";
            document.getElementById('add-override-active').value = s.manualOverride ? "true" : "false";
            document.getElementById('add-override-step').value = s.forcedStep || "";

            const routeString = s.milestones.map(m => {
                const hours = Math.floor(m.hoursToNext);
                const mins = Math.round((m.hoursToNext - hours) * 60);
                const timeLabel = mins > 0 ? `${hours}:${mins.toString().padStart(2, '0')}` : hours;
                return `${m.location} - ${timeLabel} - ${m.icon}`;
            }).join('\n');
            
            document.getElementById('add-route').value = routeString;
            document.getElementById('create-btn').textContent = "Update Manifest";
            window.scrollTo(0,0);
        });
    }

    window.deleteShipment = function(num) { if(confirm('Delete permanently?')) db.ref('shipments/' + num).remove(); }

    document.getElementById('add-form').addEventListener('submit', e => {
      e.preventDefault();
      const num = document.getElementById('add-number').value.trim().toUpperCase();
      const routeText = document.getElementById('add-route').value;
      const lines = routeText.trim().split('\n').filter(l => l.includes('-'));
      
      let total = 0;
      const milestones = lines.map(line => {
        const parts = line.split('-').map(p => p.trim());
        const hoursValue = parseTimeToHours(parts[1]);
        const m = { location: parts[0], hoursToNext: hoursValue, icon: parts[2] || 'ðŸ“¦', cumulativeHours: total };
        total += hoursValue;
        return m;
      });

      db.ref('shipments/' + num + '/startTime').once('value', (snap) => {
          const startTime = snap.val() || new Date().toISOString();
          db.ref('shipments/' + num).set({
            origin: document.getElementById('add-origin').value,
            destination: document.getElementById('add-destination').value,
            address: document.getElementById('add-address').value,
            email: document.getElementById('add-email').value,
            phone: document.getElementById('add-phone').value,
            onHold: document.getElementById('add-hold').value === "true",
            holdReason: document.getElementById('add-hold-reason').value,
            manualOverride: document.getElementById('add-override-active').value === "true",
            forcedStep: parseInt(document.getElementById('add-override-step').value) || 0,
            milestones, totalTransitHours: total, startTime: startTime
          }).then(() => {
            alert("Saved Successfully");
            e.target.reset();
            document.getElementById('create-btn').textContent = "Save Manifest to Cloud";
          });
      });
    });

    renderAdminList();
  </script>
</body>
</html>
