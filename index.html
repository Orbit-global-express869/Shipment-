<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Staff Portal - Orbit Global Express</title>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    :root {
      --primary: #004aad;
      --accent: #ffd700;
      --success: #28a745;
      --bg-light: #f4f7f9;
      --text-dark: #2c3e50;
      --border: #e0e6ed;
    }

    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-light); color: var(--text-dark); padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    h2 { color: var(--primary); text-align: center; margin-bottom: 30px; }
    
    input, textarea, select { padding: 14px; border: 2px solid var(--border); border-radius: 10px; width: 100%; margin-bottom: 15px; font-size: 1rem; }
    label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--primary); }
    
    .hold-section { background: #fff3cd; padding: 20px; border-radius: 10px; border: 1px solid #ffeeba; margin-bottom: 20px; }
    
    button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
    button:hover { background: #003580; }

    .admin-card { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
    .edit-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 5px; }
    .delete-btn { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Staff Manifest Portal</h2>
    
    <form id="add-form">
      <label>Tracking ID</label>
      <input type="text" id="add-number" placeholder="e.g., OGE-7744" required>

      <div style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Origin</label>
          <input type="text" id="add-origin" placeholder="City, Country" required>
        </div>
        <div style="flex:1;">
          <label>Destination</label>
          <input type="text" id="add-destination" placeholder="City, Country" required>
        </div>
      </div>

      <label>Full Recipient Address</label>
      <input type="text" id="add-address" placeholder="123 Diplomatic Way, New York" required>

      <div style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Customer Email</label>
          <input type="email" id="add-email" placeholder="client@email.com" required>
        </div>
        <div style="flex:1;">
          <label>Customer Phone</label>
          <input type="tel" id="add-phone" placeholder="+1..." required>
        </div>
      </div>

      <div class="hold-section">
        <label>Shipment Progress Status</label>
        <select id="hold-status">
          <option value="false">Active (Moving Normally)</option>
          <option value="true">On Hold (Pending Action)</option>
        </select>
        <label>Hold Reason (Only visible if On Hold)</label>
        <input type="text" id="hold-reason" placeholder="e.g., Awaiting Diplomatic Clearance Fee">
      </div>

      <label>Route Manifest (History)</label>
      <textarea id="add-route" placeholder="Format: Location - Hours - Icon&#10;London - 24 - ðŸ“¦&#10;In Transit - 12 - ðŸšš" rows="6" required></textarea>
      
      <button type="submit" id="create-btn">Save Manifest</button>
    </form>

    <div id="shipment-list" style="margin-top:40px;">
      <h3 style="border-bottom: 2px solid var(--border); padding-bottom: 10px;">Active Database</h3>
    </div>
  </div>

  <script>
    // --- DATABASE CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyAreX9tA9P0t8qHdbD9P0t8qHdbD9",
      authDomain: "orbit-global-b4699.firebaseapp.com",
      databaseURL: "https://orbit-global-b4699-default-rtdb.firebaseio.com",
      projectId: "orbit-global-b4699",
      storageBucket: "orbit-global-b4699.appspot.com",
      messagingSenderId: "456431441728",
      appId: "1:456431441728:web:e1742f5341441728"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function renderAdminList() {
      db.ref('shipments').on('value', (snap) => {
        const data = snap.val() || {};
        const list = document.getElementById('shipment-list');
        list.innerHTML = '<h3 style="border-bottom: 2px solid var(--border); padding-bottom: 10px;">Active Database</h3>';
        
        Object.keys(data).forEach(num => {
          const s = data[num];
          const div = document.createElement('div');
          div.className = 'admin-card';
          div.innerHTML = `<div><strong>${num}</strong> <small>(${s.onHold ? 'â›” ON HOLD' : 'âœ… ACTIVE'})</small></div>
                           <div><button class="edit-btn" onclick="editShipment('${num}')">Edit</button>
                           <button class="delete-btn" onclick="deleteShipment('${num}')">Delete</button></div>`;
          list.appendChild(div);
        });
      });
    }

    window.editShipment = function(num) {
      db.ref('shipments/' + num).once('value', (snap) => {
        const s = snap.val();
        document.getElementById('add-number').value = num;
        document.getElementById('add-origin').value = s.origin;
        document.getElementById('add-destination').value = s.destination;
        document.getElementById('add-address').value = s.address;
        document.getElementById('add-email').value = s.email;
        document.getElementById('add-phone').value = s.phone;
        document.getElementById('hold-status').value = s.onHold ? "true" : "false";
        document.getElementById('hold-reason').value = s.holdReason || "";
        
        const routeString = s.milestones.map(m => `${m.location} - ${m.hoursToNext} - ${m.icon}`).join('\n');
        document.getElementById('add-route').value = routeString;
        document.getElementById('create-btn').textContent = "Update Manifest";
        window.scrollTo(0,0);
      });
    };

    window.deleteShipment = function(num) { 
      if(confirm('Are you sure you want to delete this shipment?')) { 
        db.ref('shipments/' + num).remove();
      } 
    };

    document.getElementById('add-form').addEventListener('submit', e => {
      e.preventDefault();
      const num = document.getElementById('add-number').value.trim().toUpperCase();
      const routeText = document.getElementById('add-route').value;
      const lines = routeText.trim().split('\n').filter(l => l.includes('-'));
      
      let total = 0;
      const milestones = lines.map(line => {
        const parts = line.split('-').map(p => p.trim());
        const m = { location: parts[0], hoursToNext: parseFloat(parts[1]) || 0, icon: parts[2] || 'ðŸ“¦', cumulativeHours: total };
        total += m.hoursToNext;
        return m;
      });

      // Fetch existing start time if editing, otherwise new time
      db.ref('shipments/' + num + '/startTime').once('value', (snap) => {
        const startTime = snap.val() || new Date().toISOString();
        
        db.ref('shipments/' + num).set({
          origin: document.getElementById('add-origin').value,
          destination: document.getElementById('add-destination').value,
          address: document.getElementById('add-address').value,
          email: document.getElementById('add-email').value,
          phone: document.getElementById('add-phone').value,
          onHold: document.getElementById('hold-status').value === "true",
          holdReason: document.getElementById('hold-reason').value,
          milestones,
          totalTransitHours: total,
          startTime: startTime
        }).then(() => {
          alert("Manifest Successfully Saved to Cloud.");
          e.target.reset();
          document.getElementById('create-btn').textContent = "Create Manifest";
        });
      });
    });

    renderAdminList();
  </script>
</body>
</html>
